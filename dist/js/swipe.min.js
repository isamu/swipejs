"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),SwipeBook=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=arguments[2],s=arguments[3];_classCallCheck(this,e),$("head").prepend('<meta name="viewport" content="width = 640,user-scalable=no">'),this.step=i,this.data=t,this.pages=[],this.title="Swipe",this.base_css_id=a,this.back_css_id=s,e.setTemplateElements(this.getTemplateElements()),e.setMarkdown(this.getMarkdown()),this.templatePages=this.getTemplatePages(),this.setScreen(),this.paging=this.getPaging(),this.load(),this.domLoad()}return _createClass(e,null,[{key:"setTemplateElements",value:function(e){this.templateElements=e}},{key:"getTemplateElements",value:function(){return this.templateElements}},{key:"setMarkdown",value:function(e){this.markdown=e}},{key:"getMarkdown",value:function(){return this.markdown}},{key:"pageInDuration",value:function(){return 400}}]),_createClass(e,[{key:"setScreen",value:function(){this.dimension=this.data.dimension?this.data.dimension:[$(window).width(),$(window).height()],SwipeScreen.init(this.dimension[0],this.dimension[1]),this.bc=this.data.bc||"#a9a9a9",this.setSwipeCss()}},{key:"load",value:function(){var e=this;$.each(this.data.pages,function(t,i){var a;i.scene&&(a=e.templatePages[i.scene])&&(a=e.templatePages[i.scene]),i.template&&(a=e.templatePages[i.template])&&(a=e.templatePages[i.template]);var s=new SwipePage(i,a,t);e.pages.push(s)}),this.data.title&&(this.title=this.data.title,document.title=this.title)}},{key:"getTemplatePages",value:function(){return this.data.templates&&this.data.templates.pages?this.data.templates.pages:this.data.scenes?this.data.scenes:{}}},{key:"getTemplateElements",value:function(){return this.data.templates&&this.data.templates.elements?this.data.templates.elements:this.data.elements?this.data.elements:{}}},{key:"getMarkdown",value:function(){return this.data.markdown?this.data.markdown:{}}},{key:"getPaging",value:function(){return"leftToRight"==this.data.paging||"vertical"==this.data.paging||"rightToLeft"==this.data.paging?this.data.paging:"vertical"}},{key:"setSwipeCss",value:function(){var e=($(window).width()-SwipeScreen.virtualwidth())/2;$(this.base_css_id).css({height:SwipeScreen.virtualheight(),width:SwipeScreen.virtualwidth(),position:"absolute",left:e}),$(this.back_css_id).css({"background-color":this.bc,height:"100vh",width:"100vw"})}},{key:"resize",value:function(){this.setScreen();for(var e=0;e<this.pages.length;e++)this.justShow(e);this.setPageSize()}},{key:"setPageSize",value:function(){$("svg").css("overflow","visible"),$(".page").css({overflow:"hidden",height:SwipeScreen.virtualheight(),width:SwipeScreen.virtualwidth()})}},{key:"domLoad",value:function(){var e=[],t=this;this.pages.forEach(function(t,i){t.loadElement(),e.push(t.getHtml())}),$(this.base_css_id).html(e.join("")),this.setPageSize(),$(".page").css("opacity",0),$("#page_"+this.step).css("opacity",1),this.pages[this.step].active(),$(".image_element").load(function(){$(this).attr("__default_width",$(this).width()),$(this).attr("__default_height",$(this).height()),t.initData($(this).attr("__page_id"),$(this).attr("__element_id")),SwipeCounter.decrease(),0==SwipeCounter.getCounter()&&t.loadFinish()}),$(".element").each(function(e,i){t.initData($(i).attr("__page_id"),$(i).attr("__element_id")),SwipeCounter.decrease(),0==SwipeCounter.getCounter()&&t.loadFinish()}),this.pages.forEach(function(e,t){var i=e.getBc();$("#page_"+t).css({"background-color":i})}),$(".page").css({position:"absolute"}),$(".image_element").css({position:"absolute"}),$(".video_element").css({position:"absolute"}),$(".text_element").css({position:"absolute"}),$(".svg_element").css({position:"absolute"})}},{key:"loadFinish",value:function(){this.show(this.step)}},{key:"initData",value:function(e,t){this.pages[e].initElement(t)}},{key:"next",value:function(){this.step<this.pages.length-1&&this.show(this.step+1)}},{key:"back",value:function(){this.step>0&&this.show(this.step-1)}},{key:"justShow",value:function(e){this.pages[e].justShow()}},{key:"show",value:function(t){var i=this.step,a=t>=i?"forward":"back",s=t==i,n=this.pages[i].getScene()&&this.pages[t]&&this.pages[t].getScene()==this.pages[i].getScene();s||(this.pages[i].inactive(),this.pages[t].active());var o=this.pages[Math.max(i,t)].getTransition();"forward"==a?n?(this.pages[t].show(),this.pages[t].play(),$("#page_"+i).css("opacity",0),$("#page_"+t).css("opacity",1)):"fadeIn"==o?(this.pages[t].finShow(),$("#page_"+t).animate({opacity:1},{duration:e.pageInDuration()})):"replace"==o?($("#page_"+i).css({opacity:0}),$("#page_"+t).css({opacity:1}),this.pages[t].finShow()):"scroll"==o&&(setTimeout(function(){$("#page_"+i).css({opacity:0})},e.pageInDuration()),this.pageSlide("in",t),this.pages[t].delayShow()):(console.log("back"),n?(this.pages[i].back(),setTimeout(function(){$("#page_"+i).css({opacity:0}),$("#page_"+t).css({opacity:1})},e.pageInDuration())):"fadeIn"==o?(this.pages[t].finShow(),$("#page_"+i).animate({opacity:0},{duration:e.pageInDuration()})):"replace"==o?($("#page_"+i).css({opacity:0}),$("#page_"+t).css({opacity:1}),this.pages[t].finShow()):"scroll"==o&&($("#page_"+t).css({opacity:1}),this.pages[i].back(),this.pageSlide("out",i),this.pages[t].finShow())),this.step=t,location.hash=t}},{key:"getStep",value:function(){return this.step}},{key:"pageSlide",value:function(t,i){if($(".boxelement-"+i).each(function(i,a){if(console.log("box"),"in"==t)if("vertical"==this.paging)var s=$("#"+this.css_id).attr("__x"),n=s+SwipeScreen.virtualheight();else if("leftToRight"==this.paging)var o=$("#"+this.css_id).attr("__y"),h=o+SwipeScreen.virtualwidth();else var o=$("#"+this.css_id).attr("__y"),h=o-SwipeScreen.virtualwidth();else if("vertical"==this.paging)var n=$("#"+this.css_id).attr("__x"),s=n+SwipeScreen.virtualheight();else if("leftToRight"==this.paging)var h=$("#"+this.css_id).attr("__y"),o=h+SwipeScreen.virtualwidth();else var h=$("#"+this.css_id).attr("__y"),o=h-SwipeScreen.virtualwidth();"vertical"==this.paging?($(a).css("top",n),$(a).animate({top:s},{duration:e.pageInDuration()})):($(a).css("left",h),$(a).animate({left:o},{duration:e.pageInDuration()}))}),"in"==t)"vertical"==this.paging?($("#page_"+i).css("top",SwipeScreen.virtualheight()),$("#page_"+i).css("opacity",1),$("#page_"+i).animate({top:0,opacity:1},{duration:e.pageInDuration()})):"leftToRight"==this.paging?($("#page_"+i).css("left",SwipeScreen.virtualwidth()),$("#page_"+i).css("opacity",1),$("#page_"+i).animate({left:0,opacity:1},{duration:e.pageInDuration()})):($("#page_"+i).css("left",-SwipeScreen.virtualwidth()),$("#page_"+i).css("opacity",1),$("#page_"+i).animate({left:0,opacity:1},{duration:e.pageInDuration()}));else{var a={duration:e.pageInDuration(),complete:function(){$("#page_"+i).css({opacity:0})}};"vertical"==this.paging?($("#page_"+i).css("top",0),$("#page_"+i).animate({top:SwipeScreen.virtualheight()},a)):"leftToRight"==this.paging?($("#page_"+i).css("left",0),$("#page_"+i).css("opacity",1),$("#page_"+i).animate({left:SwipeScreen.virtualwidth(),opacity:1},a)):($("#page_"+i).css("left",0),$("#page_"+i).css("opacity",1),$("#page_"+i).animate({left:-SwipeScreen.virtualwidth(),opacity:1},a))}}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SwipeCounter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"increase",value:function(){return void 0===this.counter?this.counter=1:this.counter++,this.counter}},{key:"decrease",value:function(){return void 0===this.counter?this.counter=-1:this.counter--,this.counter}},{key:"getCounter",value:function(){return this.counter}}]),e}();
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),SwipeElement=function(){function t(i,e,s,n,o){var a=arguments.length<=5||void 0===arguments[5]?null:arguments[5];_classCallCheck(this,t);var h="element-"+e+"-"+s;this.info=this.mergeTemplate(i),this.css_id=h,this.page_id=e,this.element_id=s,this.play_style=n,this.duration=o,this.parent=a,this.isActive=!1,this.videoElement=null,this.isRepeat=Boolean(i.repeat),this.x=0,this.y=0,this.angle=0,this.scale=[1,1],this.no_size=!1,this.transition_timing=null,this.loop_timing=null,this.elements=[];var r=this;this.bc=null,this.info.bc&&(this.bc=this.info.bc),this.info.elements&&this.info.elements.forEach(function(i,a){var h=s+"-"+a;r.elements.push(new t(i,e,h,n,o,r))})}return _createClass(t,[{key:"mergeTemplate",value:function(t){if(t.element||t.template){var i,e=SwipeBook.getTemplateElements();(i=e[t.element||t.template])&&(t=SwipeParser.inheritProperties(t,i))}return t}},{key:"parseText",value:function(t){return"string"==typeof t?t:"object"==("undefined"==typeof t?"undefined":_typeof(t))?t.ref?SwipeParser.localizedStringForKey(t.ref):SwipeParser.localizedString(t,"ja"):""}},{key:"parseMarkdown",value:function(t){var i=SwipeBook.getMarkdown(),e=new SwipeMarkdown(i);return e.parse(t,this.css_id)}},{key:"initData",value:function(t){if(void 0!==t){var i=t.split("-");return void(1==i.length?this.elements[t].initData():this.elements[i.shift()].initData(i.join("-")))}(this.isDiv()||this.isMarkdown())&&(this.parent||$("#"+this.css_id).css("position","absolute")),this.isPath()&&(this.snap=Snap("#"+this.css_id),this.path=this.snap.path(),this.bbox=null),this.setSize(),this.setPosition(),this.setOption(),$("#"+this.css_id).attr("__x",this.x),$("#"+this.css_id).attr("__y",this.y),$("#"+this.css_id).attr("__w",this.w),$("#"+this.css_id).attr("__h",this.h),this.bc&&$("#"+this.css_id).css({"background-color":this.bc}),this.initAllData(),this.isPath()&&(this.prevPath=this.parsePath(),this.finPath=this.parseFinPath()),this.setPrevPos(),this.isPath()&&(this.bbox=this.path.getBBox(),this.setFinPath(),this.finbbox=this.path.getBBox(),this.setPrevPath()),this.markdown_position()}},{key:"initAllData",value:function(){this.initPosData=[Number(this.x),Number(this.y),Number(this.w),Number(this.h),Number(this.angle),Number(this.opacity),this.scale],this.originalPrevPos=this.updatePosition(this.initPosData,this.info),this.prevPos=this.getScreenPosition(this.originalPrevPos),this.originalFinPos=this.getOriginalFinPos(),this.finPos=this.getScreenPosition(this.originalFinPos),this.isText()&&(this.prevText=this.textLayout(this.info,this.prevPos),this.finText=this.textLayout(this.info,this.finPos))}},{key:"getOriginalFinPos",value:function(){if(this.hasTo()){var t=this.initPosData;return this.info.to.pos&&this.info.to.pos.match(/^M/),this.updatePosition(t,SwipeUtil.merge(this.info,this.info.to))}return this.originalPrevPos}},{key:"path2pos",value:function(t){var i=[0,0],e=t.match(/(\w[0-9\s\.,\-]+)/g);return $.each(e,function(t,e){var s=e.slice(0,1),n=e.slice(1).split(",");"M"==s&&(i=[Number(n[0]),Number(n[1])]),"l"==s&&(i=[Number(i[0])+Number(n[0]),Number(i[1])+Number(n[1])])}),i}},{key:"setOption",value:function(){this.opacity=1,null!=this.info.opacity&&(this.opacity=this.info.opacity),this.info.clip&&this.info.clip===!0&&$("#"+this.css_id).css("overflow","hidden")}},{key:"setSize",value:function(){this.info.size?(this.w=this.info.size[0],this.h=this.info.size[1]):(this.info.w?this.w=SwipeParser.parseSize(this.info.w,SwipeScreen.swipewidth(),SwipeScreen.swipewidth()):this.info.img?this.w=$("#"+this.css_id).attr("__default_width"):(this.w=this.parentWidth(),this.no_size=!0),this.info.h?this.h=SwipeParser.parseSize(this.info.h,SwipeScreen.swipeheight(),SwipeScreen.swipeheight()):this.info.img?this.h=$("#"+this.css_id).attr("__default_height"):(this.h=this.parentHeight(),this.no_size=!0))}},{key:"setPosition",value:function(){this.info.pos?(this.x=this.info.pos[0],this.y=this.info.pos[1]):("right"==this.info.x?this.x=this.parentWidth()-this.w:"left"==this.info.x?this.x=0:"center"==this.info.x?this.x=(this.parentWidth()-this.w)/2:this.info.x&&(this.x=SwipeParser.parseSize(this.info.x,this.parentWidth(),0)),"bottom"==this.info.y?this.y=this.parentHeight()-this.h:"top"==this.info.y?this.y=0:"center"==this.info.y?this.y=(this.parentHeight()-this.h)/2:this.info.y&&(this.y=SwipeParser.parseSize(this.info.y,this.parentHeight(),0))),this.info.rotate&&(this.angle=this.info.rotate),this.scale=this.getScale(this.info)}},{key:"getWidth",value:function(){return this.w?this.w:this.parent?this.parent.getWidth():SwipeScreen.swipewidth()}},{key:"getHeight",value:function(){return this.h?this.h:this.parent?this.parent.getHeight():SwipeScreen.swipeheight()}},{key:"parentWidth",value:function(){var t;return this.parent&&(t=this.parent.getWidth()),t?t:SwipeScreen.swipewidth()}},{key:"parentHeight",value:function(){var t;return this.parent&&(t=this.parent.getHeight()),t?t:SwipeScreen.swipeheight()}},{key:"setVideo",value:function(t){var i=this;$("#"+this.css_id).html("<video id='"+this.css_id+"-video' width='"+t[2]+"' height='"+t[3]+"'><source type='video/mp4' src='"+this.info.video+"'  /></video>"),$("#"+this.css_id+"-video").mediaelementplayer({flashName:"flashmediaelement.swf",loop:!0,success:function(t,e){i.videoElement=t}})}},{key:"getPrevPathTranslate",value:function(){if(null==this.bbox)return" ";var t=this.bbox.width>0?-(this.bbox.width/2-this.prevPos[2]/2):0,i=this.bbox.height>0?-(this.bbox.height/2-this.prevPos[3]/2):0;return console.log(" translate("+t+", "+i+") ")," translate("+t+", "+i+") "}},{key:"getFinPathTranslate",value:function(){if(null==this.finbbox)return" ";var t=this.finbbox.width>0?-(this.finbbox.width/2-this.finPos[2]/2):0,i=this.finbbox.height>0?-(this.finbbox.height/2-this.finPos[3]/2):0;return console.log(" translate("+t+", "+i+") ")," translate("+t+", "+i+") "}},{key:"setPrevPos",value:function(){var t=this;$("#"+this.css_id).css(this.convCssPos(this.prevPos)),this.isVideo()&&this.setVideo(this.prevPos),this.isText()&&$("#"+this.css_id+"-body").css(this.prevText),this.isPath()&&this.setPrevPath(),this.isMarkdown()&&this.md_css.forEach(function(i,e){$("#"+t.css_id+"-"+e).css(i)})}},{key:"setPrevPath",value:function(){console.log(this.getPrevPath()),this.path.attr(this.getPrevPath())}},{key:"getPrevPath",value:function(){return{d:this.prevPath.d,fill:this.prevPath.fill,transform:this.getPrevPathTranslate()+this.prevPath.transform,stroke:this.prevPath.stroke,strokeWidth:this.prevPath.strokeWidth}}},{key:"setFinPath",value:function(){this.path.attr(this.getFinPath())}},{key:"getFinPath",value:function(){return{d:this.finPath.d,fill:this.finPath.fill,transform:this.getFinPathTranslate()+this.finPath.transform,stroke:this.finPath.stroke,strokeWidth:this.finPath.strokeWidth}}},{key:"textLayout",value:function(t,i){var e="center",s="center";if(t.textAlign)switch(t.textAlign){case"left":s="left";break;case"right":s="right";break;case"top":e="top";break;case"bottom":e="bottom"}var n=SwipeParser.parseFontName(t,!1),o=function(t,i){var e=20/480*SwipeScreen.swipeheight(),s=SwipeParser.parseFontSize(t,SwipeScreen.swipeheight(),e,!1);return Math.round(s*i[1])}(t,i[6]),a=o,h=i[3],r=0;return"bottom"==e?r=h-a:"center"==e&&(r=(h-a)/2),{position:"relative",top:String(SwipeScreen.virtualY(r))+"px","font-size":String(SwipeScreen.virtualY(o))+"px","line-height":String(SwipeScreen.virtualY(o))+"px","font-family":n,textAlign:s,color:SwipeParser.parseColor(t,"#000")}}},{key:"conv_rgba2rgb",value:function(t){var i=void 0;return(i=t.match(/^(#\w{6})(\w{2})$/))?i[1]:t}},{key:"transform",value:function(t,i){var e=[],s=[SwipeScreen.getRation(),SwipeScreen.getRation()];i&&(s=[s[0]*i[0],s[1]*i[1]]);var n=[s[0],s[1]];e.push("scale("+n.join(",")+")");var o=t.rotate?[t.rotate[2]||0,this.prevPos[2]/2,this.prevPos[3]/2].join(","):"0,0,0";return e.push("rotate("+o+")"),e.join(" ")}},{key:"parsePath",value:function(){var t=this.info.lineWidth?this.info.lineWidth:1,i=this.info.strokeColor?this.info.strokeColor:"black",e=this.info.fillColor?this.info.fillColor:"none";return{d:this.info.path,stroke:this.conv_rgba2rgb(i),transform:this.transform(this.info,this.scale),fill:this.conv_rgba2rgb(e),strokeWidth:t}}},{key:"parseFinPath",value:function(){if(!this.hasTo())return this.getPrevPath();var t=SwipeUtil.merge(this.info,this.info.to),i=t.lineWidth?t.lineWidth:1,e=t.strokeColor?t.strokeColor:"black",s=t.fillColor?t.fillColor:"none";t.rotate?[t.rotate[2],this.prevPos[2]/2,this.prevPos[3]/2].join(","):"0,0,0";return{d:t.path,stroke:this.conv_rgba2rgb(e),transform:this.transform(t,this.getScale(t)),fill:this.conv_rgba2rgb(s),strokeWidth:i}}},{key:"animatePrevPos",value:function(){if($("#"+this.css_id).animate(this.convCssPos(this.prevPos),{duration:this.duration}),this.hasTo()&&(this.isText()&&$("#"+this.css_id+"-body").animate(this.prevText,{duration:this.duration}),this.isPath())){var t=SwipeParser.clone(this.getPrevPath());delete t.stroke,this.path.animate(t,this.duration)}}},{key:"markdown_position",value:function(){if(this.isMarkdown()){var t=($("#"+this.css_id).height()-$("#md_"+this.css_id).height())/2;$("#md_"+this.css_id).css({top:t,position:"absolute"})}}},{key:"setFinPos",value:function(){if($("#"+this.css_id).css(this.convCssPos(this.finPos)),this.isVideo()&&this.setVideo(this.finPos),this.isText()){var t=this.textLayout(this.info,this.finPos);$("#"+this.css_id+"-body").css(t)}}},{key:"animateFinPos",value:function(){if(this.hasTo()){this.transition_timing=this.getTiming(this.info.to,this.duration);var t=this.transition_timing[0],i=this.transition_timing[1],e=this;setTimeout(function(){if($("#"+e.css_id).animate(e.convCssPos(e.finPos),{duration:i}),e.isText()&&$("#"+e.css_id+"-body").animate(e.finText,{duration:i}),e.isPath()){var t=SwipeParser.clone(e.getFinPath());delete t.stroke,e.path.animate(t,i)}},t)}}},{key:"updatePosition",value:function(t,i){var e=Object.assign({},t);if(null!=i.opacity&&(e[5]=Number(i.opacity)),i.translate){var s=i.translate;e[0]=e[0]+Number(s[0]),e[1]=e[1]+Number(s[1])}return this.isPath()||i.scale&&(e[6]=this.getScale(i),e=this.applyScale(e)),e}},{key:"getScreenPosition",value:function(t){return[SwipeScreen.virtualX(t[0]),SwipeScreen.virtualY(t[1]),SwipeScreen.virtualX(t[2]),SwipeScreen.virtualY(t[3]),t[4],t[5],t[6]]}},{key:"getScale",value:function(t){var i=arguments.length<=1||void 0===arguments[1]?[1,1]:arguments[1];return t.scale&&(SwipeParser.is("Array",t.scale)&&2==t.scale.length?i=t.scale:SwipeParser.is("Number",t.scale)?i=[t.scale,t.scale]:SwipeParser.is("String",t.scale)&&(i=[Number(t.scale),Number(t.scale)])),i}},{key:"applyScale",value:function(t){var i=t[6];if(i&&2==i.length&&1!=i[0]&&1!=i[1]){var e=t[2]*i[0],s=t[3]*i[1],n=t[0]-(e-t[2])/2,o=t[1]-(s-t[3])/2;t[0]=n,t[1]=o,t[2]=e,t[3]=s}return t}},{key:"convCssPos",value:function(t){var i={left:t[0]+"px",top:t[1]+"px",width:t[2]+"px",height:t[3]+"px",opacity:t[5]};if(t[4]){var e="rotate("+t[4]+"deg)";i["-moz-transform"]=e,i["-webkit-transform"]=e,i["-o-transform"]=e,i["-ms-transform"]=e}return i}},{key:"type",value:function(){return this.info.img?"image":this.info.video?"video":this.info.text?"text":this.info.markdown?"markdown":this.info.path?"path":"div"}},{key:"isImage",value:function(){return"image"==this.type()}},{key:"isVideo",value:function(){return"video"==this.type()}},{key:"isText",value:function(){return"text"==this.type()}},{key:"isMarkdown",value:function(){return"markdown"==this.type()}},{key:"isPath",value:function(){return"path"==this.type()}},{key:"isDiv",value:function(){return"div"==this.type()}},{key:"hasTo",value:function(){return!!this.info.to}},{key:"html",value:function(){this.type()&&SwipeCounter.increase();var t=this.elements.map(function(t,i){return t.html()}).join("");if(this.isImage())return"<img src='"+this.info.img+"' class='image_element' id='"+this.css_id+"' __page_id='"+this.page_id+"' __element_id='"+this.element_id+"' >"+t+"</img>";if(this.isText())return"<div class='element text_element' id='"+this.css_id+"' __page_id='"+this.page_id+"' __element_id='"+this.element_id+"' ><div class='text_body' id='"+this.css_id+"-body'>"+this.parseText(this.info.text)+t+"</div></div>";if(this.isMarkdown()){var i=this.parseMarkdown(this.info.markdown);return this.md_css=i[1],"<div class='element markdown_element' id='"+this.css_id+"' __page_id='"+this.page_id+"' __element_id='"+this.element_id+"' ><div class='markdown_wrap' id='md_"+this.css_id+"'>"+i[0]+t+"</div></div>"}return this.isVideo()?"<div class='element video_element' id='"+this.css_id+"' __page_id='"+this.page_id+"' __element_id='"+this.element_id+"' >"+t+"</div>":this.isPath()?'<svg class="element svg_element" id="'+this.css_id+'" __page_id="'+this.page_id+'" __element_id="'+this.element_id+'" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"></svg>':this.isDiv()?"<div class='element boxelement-"+this.page_id+"' id='"+this.css_id+"' __page_id='"+this.page_id+"' __element_id='"+this.element_id+"' >"+t+"</div>":""}},{key:"justShow",value:function(){console.log("justShow"),this.elements&&this.elements.forEach(function(t,i){t.justShow()}),this.no_size&&this.setSize(),this.setFinPos()}},{key:"show",value:function(){console.log("show"),this.elements&&this.elements.forEach(function(t,i){t.show()}),this.setPrevPos(),this.animateFinPos(),this.loopProcess()}},{key:"delayShow",value:function(){console.log("delayShow"),this.elements&&this.elements.forEach(function(t,i){t.delayShow()}),this.setPrevPos();var t=this;setTimeout(function(){t.animateFinPos(),t.loopProcess()},SwipeBook.pageInDuration())}},{key:"getTiming",value:function(t,i){var e=function(t){if(t.timing){var i=t.timing;if(2==i.length&&i[0]>0&&i[1]>=i[0]&&i[1]<=1)return i}return[0,1]}(t);return[e[0],e[1]-e[0],1-e[1]].map(function(t){return t*i})}},{key:"getLoopDuration",value:function(t){var i=t;return this.transition_timing&&(i=0==this.transition_timing[2]?200:this.transition_timing[2]),this.valueFrom(this.info.loop,"duration",i)}},{key:"loopProcess",value:function(){if(this.info.loop){var t=this.getLoopDuration(this.duration);if(this.loop_timing=this.getTiming(this.info.loop,t),"scroll"!=this.play_style&&this.hasTo())if("auto"==this.play_style||"always"==this.play_style){var i=this.duration;this.transition_timing&&(i-=this.transition_timing[2]);var e=this;setTimeout(function(){e.loop(e)},i)}else console.log("not animate because "+this.play);else this.loop(this)}}},{key:"moreloop",value:function(t,i,e){i--;var s=this.loop_timing[2];setTimeout(function(){i>0?t.loop(t,i):t.isRepeat&&t.isActive&&(i=e,t.loop(t,i))},s)}},{key:"loop",value:function(t){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];console.log("loop");var e,s=t.info.loop,n=this.loop_timing[0],o=this.loop_timing[1];e=s.count?s.count:1,null==i&&(i=e),setTimeout(function(){switch(s.style){case"vibrate":var n=t.valueFrom(s,"delta",10),a=t.originalFinPos,h=o/e/4;$("#"+t.css_id).animate({left:parseInt(SwipeScreen.virtualX(a[0]-n))+"px",top:SwipeScreen.virtualY(a[1])+"px"},{duration:h}),setTimeout(function(){$("#"+t.css_id).animate({left:parseInt(SwipeScreen.virtualX(a[0]+n))+"px",top:SwipeScreen.virtualY(a[1])+"px"},{duration:2*h}),setTimeout(function(){$("#"+t.css_id).animate({left:parseInt(SwipeScreen.virtualX(a[0]))+"px",top:SwipeScreen.virtualY(a[1])+"px"},{duration:h}),setTimeout(function(){i--,i>0?t.loop(t,i):t.isRepeat&&t.isActive&&(i=e,t.loop(t,i))},h)},2*h)},h);break;case"shift":var r,a=t.originalFinPos;switch(s.direction){case"n":r={left:parseInt(SwipeScreen.virtualX(s[0]))+"px",top:SwipeScreen.virtualY(s[1]-t.h)+"px"};break;case"e":r={left:parseInt(SwipeScreen.virtualX(s[0]+t.w))+"px",top:SwipeScreen.virtualY(s[1])+"px"};break;case"w":r={left:parseInt(SwipeScreen.virtualX(s[0]-t.w))+"px",top:SwipeScreen.virtualY(s[1])+"px"};break;default:r={left:parseInt(SwipeScreen.virtualX(s[0]))+"px",top:SwipeScreen.virtualY(s[1]-t.h)+"px"}}var h=o/e;t.setPrevPos(),$("#"+t.css_id).animate(r,{duration:h,complete:function(){$("#"+t.css_id).animate(t.convCssPos(a,1),{duration:0,complete:function(){t.moreloop(t,i,e)}})}});break;case"blink":console.log("blink");var h=o/e/4;$("#"+t.css_id).css({opacity:1}),setTimeout(function(){$("#"+t.css_id).css({opacity:0}),setTimeout(function(){$("#"+t.css_id).css({opacity:1}),setTimeout(function(){t.moreloop(t,i,e)},h)},2*h)},h);break;case"spin":console.log("spin");var h=o/e;$("#"+t.css_id).rotate({angle:0,animateTo:360,duration:h,callback:function(){t.moreloop(t,i,e)}});break;case"wiggle":console.log("wiggle");var l=t.valueFrom(s,"delta",15),h=o/e/4;$("#"+t.css_id).rotate({angle:0,animateTo:l,duration:h,callback:function(){$("#"+t.css_id).rotate({angle:l,animateTo:-l,duration:2*h,callback:function(){$("#"+t.css_id).rotate({angle:-l,animateTo:0,duration:h,callback:function(){t.moreloop(t,i,e)}})}})}});break;case"path":case"sprite":}},n)}},{key:"valueFrom",value:function(t,i,e){return t[i]?t[i]:e}},{key:"back",value:function(){console.log("back"),this.elements&&this.elements.forEach(function(t,i){t.back()}),this.setFinPos(),this.animatePrevPos()}},{key:"finShow",value:function(){console.log("finShow"),this.elements&&this.elements.forEach(function(t,i){t.finShow()}),this.setFinPos(),this.loopProcess()}},{key:"play",value:function(){this.elements&&this.elements.forEach(function(t,i){t.play()}),this.videoElement&&this.videoElement.play()}},{key:"inactive",value:function(){this.elements&&this.elements.forEach(function(t,i){t.inactive()}),this.isActive=!1}},{key:"active",value:function(){this.elements&&this.elements.forEach(function(t,i){t.active()}),this.isActive=!0}}]),t}();
"use strict";function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),SwipeMarkdown=function(){function e(n){_classCallCheck(this,e),this.info=n,this.setMdStyle(),this.info.styles&&(this.md_style=$.extend(!0,this.md_style,this.info.styles)),this.info.shadow&&(this.shadow=this.info.shadow)}return _createClass(e,[{key:"parse",value:function(e,n){var t=this,i=!1,r=e.map(function(e,n){return"```"===e?(i=!i,i?[null,""]:["```+",""]):i?["```",e]:t.getMdSymbol(e)}),s=[],a=[];return r.forEach(function(e,i){var r=e[0],o=e[1];t.prefixes(r)&&(o=t.prefixes(r)+o),s.push(t.conv_html(o,n,i)),a.push(t.conv_css(r))}),[s.join(""),a]}},{key:"conv_html",value:function(e,n,t){var i=e.replace(/\s/g,"&nbsp;");return"<div class='markdown_line' id='"+n+"-"+t+"'>"+i+"</div>"}},{key:"conv_css",value:function(e){var n=this.md_style[e],t=20,i=30,r="",s="left";n&&(n.font&&(n.font.name&&(r=SwipeParser.parseFontName(n.font,!0)),n.font.size&&(t=SwipeParser.parseFontSize(n.font,SwipeScreen.swipeheight(),10,!0),i=t)),n.alignment&&(s=n.alignment),i+=n.spacing?SwipeParser.parseSize(n.spacing,SwipeScreen.swipeheight(),10):10);var a={position:"relative","font-size":String(SwipeScreen.virtualY(t))+"px","line-height":String(SwipeScreen.virtualY(i))+"px","font-family":r,textAlign:s,color:SwipeParser.parseColor(n,"#000")};return this.shadow&&(a["text-shadow"]=SwipeParser.parseShadow(this.shadow),console.log(a["text-shadow"])),a}},{key:"setMdStyle",value:function(){var e;this.md_style=(e={"###":{color:"#800",font:{size:"4%",name:"Helvetica"}},"#":{font:{size:32},spacing:16},"##":{font:{size:28},spacing:14}},_defineProperty(e,"###",{font:{size:24},spacing:12}),_defineProperty(e,"####",{font:{size:22},spacing:10}),_defineProperty(e,"*",{font:{size:20},spacing:10}),_defineProperty(e,"-",{font:{size:20},spacing:5}),_defineProperty(e,"```",{font:{size:14,name:"Courier"},spacing:0}),_defineProperty(e,"```+",{font:{size:7,name:"Courier"},spacing:0}),e)}},{key:"getMdStyle",value:function(){return this.md_style}},{key:"getMdSymbol",value:function(e){var n=this.getMdStyle(),t=e.split(" ");if(t.length>1&&n[t[0]]){var i=t.shift();return[i,t.join(" ")]}return["*",e]}},{key:"prefixes",value:function(e){var n=this.md_style[e];if(n&&n.prefix)return n.prefix;var t={"-":"• ","```":" "};return e&&t.hasOwnProperty(e)?t[e]:null}}]),e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),SwipePage=function(){function e(t,n,i){_classCallCheck(this,e),n&&(t=SwipeParser.inheritProperties(t,n)),this.page=t,this.scene=n,this.index=i,this.elements=[],this.duration=this.page.duration?1e3*this.page.duration:200,this.bc=this.page.bc||"#ffffff",this.play_style=this.page.play||"auto",this.transition=this.page.transition||("scroll"==this.play_style?"replace":"scroll")}return _createClass(e,[{key:"loadElement",value:function(){var e=this;this.page.elements.forEach(function(t,n){e.elements.push(new SwipeElement(t,e.index,n,e.play_style,e.duration))})}},{key:"elementLoad",value:function(e){var t=[],n=this;return t.push(e),e.elements&&e.elements.forEach(function(i,a){n.elementLoad(i).forEach(function(n,i){var a=Object.assign({},e);delete a.elements,t.push($.extend(!0,a,n))})}),t}},{key:"getHtml",value:function(){var e=[];return this.elements.forEach(function(t,n){e.push(t.html())}),"<div id='page_"+this.index+"' class='page' __page_id='"+this.index+"'>"+e.join("")+"</div>"}},{key:"getBc",value:function(){return this.bc}},{key:"getTransition",value:function(){return this.transition}},{key:"initElement",value:function(e){var t=e.split("-");1==t.length?this.elements[e].initData():this.elements[t.shift()].initData(t.join("-"))}},{key:"justShow",value:function(){this.elements.forEach(function(e,t){e.justShow()})}},{key:"show",value:function(){var e=this;this.elements.forEach(function(e,t){e.show()}),setTimeout(function(){e.speech(e)},this.duration)}},{key:"delayShow",value:function(){var e=this;this.elements.forEach(function(e,t){e.delayShow()}),setTimeout(function(){e.speech(e)},this.duration)}},{key:"back",value:function(){var e=this;this.elements.forEach(function(e,t){e.back()}),setTimeout(function(){e.speech(e)},this.duration)}},{key:"finShow",value:function(){this.elements.forEach(function(e,t){e.finShow()})}},{key:"play",value:function(){this.elements.forEach(function(e,t){e.play()})}},{key:"getScene",value:function(){return this.scene}},{key:"speech",value:function(e){var t=window.navigator.userAgent.toLowerCase();t.indexOf("chrome")==-1&&t.indexOf("safari")==-1||e.page.speech&&speechSynthesis.speak(new SpeechSynthesisUtterance(e.page.speech.text))}},{key:"active",value:function(){this.elements.forEach(function(e,t){e.active()})}},{key:"inactive",value:function(){this.elements.forEach(function(e,t){e.inactive()})}}]),e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),SwipeParser=function(){function e(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e)}return _createClass(e,null,[{key:"parseColor",value:function(e,r){return e&&e.color?e.color:r}},{key:"transformedPath",value:function(){}},{key:"parseTransform",value:function(){}},{key:"is",value:function(e,r){var n=Object.prototype.toString.call(r).slice(8,-1);return void 0!==r&&null!==r&&n===e}},{key:"inheritProperties",value:function(r,n){var t=e.clone(r),i={};if(n){var o=e.clone(n);$.each(o,function(r,n){var o=e.clone(n);null==t[r]?t[r]=o:(e.is("Array",t[r])||e.is("object",t[r]))&&(e.is("Number",o)||e.is("String",o)?t[r]=o:(i={},$.each(o,function(r,n){e.is("String",n.id)&&(i[n.id]=r)}),t[r].forEach(function(r,n){e.is("String",r.id)&&null!=(n=i[r.id])?o[n]=e.inheritProperties(r,o[n]):o.push(r)}),t[r]=o))})}return t}},{key:"localizedStringForKey",value:function(r){var n,t={};if(n=t.strings){var i=n[r];return e.localizedString(i,"ja")}return""}},{key:"localizedString",value:function(e,r){return e[r]?e[r]:e["*"]}},{key:"parseFontSize",value:function(r,n,t,i){var o=i?"size":"fontSize";return r[o]?e.parseSize(r[o],n,t):t}},{key:"parseSize",value:function(r,n,t){return Number.isInteger(r)?r:isFinite(r)?r:e.parsePercent(r,n,t)}},{key:"parsePercent",value:function(e,r,n){var t=/^([0-9][0-9\\.]*)%$/,i=e.match(t);return i?Math.floor(i[1])/100*r:n}},{key:"parseFontName",value:function(e,r){var n=r?"name":"fontName";if(e){var t=e[n];if("string"===jQuery.type(t))return t;if("array"===jQuery.type(t))return t.join(",")}return"sans-serif, Helvetica"}},{key:"parseShadow",value:function(r){var n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],t=e.parseSize((r.offset||[])[0],SwipeScreen.swipeheight(),1)*n;t=SwipeScreen.virtualX(t);var i=e.parseSize((r.offset||[])[1],SwipeScreen.swipewidth(),1)*n;i=SwipeScreen.virtualY(i);var o=r.color||"black";return t+"px "+i+"px 3px "+o}},{key:"clone",value:function(r){var n;if(null==r||"object"!=("undefined"==typeof r?"undefined":_typeof(r)))return r;if(r instanceof Date)return n=new Date,n.setTime(r.getTime()),n;if(r instanceof Array){n=[];for(var t=0,i=r.length;t<i;t++)n[t]=e.clone(r[t]);return n}if(r instanceof Object){n={};for(var o in r)r.hasOwnProperty(o)&&(n[o]=e.clone(r[o]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}}]),e}();
"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function i(i,t){for(var h=0;h<t.length;h++){var e=t[h];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,h,e){return h&&i(t.prototype,h),e&&i(t,e),t}}(),SwipeScreen=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"setSize",value:function(i){this.size=i}},{key:"init",value:function(t,h){this.width=t,this.height=h,0==this.width&&(this.width=this.height*$(window).width()/$(window).height()),0==this.height&&(this.height=this.width*$(window).height()/$(window).width()),i.setOriginalSize(),i.setVirtualSize()}},{key:"setOriginalSize",value:function(){this.window_width=$(window).width(),this.window_height=$(window).height()}},{key:"setVirtualSize",value:function(){var i=this.window_width/this.window_height,t=this.width/this.height;this.ration=1,i/t>=1?(this.virtual_height=$(window).height(),this.virtual_width=this.width/this.height*this.virtual_height):(this.virtual_width=$(window).width(),this.virtual_height=this.height/this.width*this.virtual_width),this.ration=this.virtual_width/this.width,this.size&&(this.virtual_width=this.virtual_width*this.size/100,this.virtual_height=this.virtual_height*this.size/100,this.ration=this.ration*this.size/100)}},{key:"getRation",value:function(){return this.ration}},{key:"swipewidth",value:function(){return this.width}},{key:"swipeheight",value:function(){return this.height}},{key:"virtualwidth",value:function(){return this.virtual_width}},{key:"virtualheight",value:function(){return this.virtual_height}},{key:"refresh",value:function(){i.setOriginalSize(),i.setVirtualSize()}},{key:"virtualX",value:function(i){return void 0==i?this.virtual_width:this.width?i/this.width*this.virtual_width:i}},{key:"virtualY",value:function(i){return void 0==i?this.virtual_height:this.height?i/this.height*this.virtual_height:i}}]),i}();
"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function i(i,t){for(var h=0;h<t.length;h++){var e=t[h];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,h,e){return h&&i(t.prototype,h),e&&i(t,e),t}}(),SwipeScreen=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"setSize",value:function(i){this.percentage=i}},{key:"init",value:function(t,h){this.width=t,this.height=h,0==this.width&&(this.width=this.height*$(window).width()/$(window).height()),0==this.height&&(this.height=this.width*$(window).height()/$(window).width()),i.setOriginalSize(),i.setVirtualSize()}},{key:"setOriginalSize",value:function(){this.window_width=$(window).width(),this.window_height=$(window).height()}},{key:"setVirtualSize",value:function(){var i=this.window_width/this.window_height,t=this.width/this.height;this.ration=1,i/t>=1?(this.virtual_height=$(window).height(),this.virtual_width=this.width/this.height*this.virtual_height):(this.virtual_width=$(window).width(),this.virtual_height=this.height/this.width*this.virtual_width),this.percentage&&(this.virtual_width=this.virtual_width*this.percentage/100,this.virtual_height=this.virtual_height*this.percentage/100),this.ration=this.virtual_width/this.width}},{key:"getRation",value:function(){return this.ration}},{key:"swipewidth",value:function(){return this.width}},{key:"swipeheight",value:function(){return this.height}},{key:"virtualwidth",value:function(){return this.virtual_width}},{key:"virtualheight",value:function(){return this.virtual_height}},{key:"refresh",value:function(){i.setOriginalSize(),i.setVirtualSize()}},{key:"virtualX",value:function(i){return void 0==i?this.virtual_width:this.width?i/this.width*this.virtual_width:i}},{key:"virtualY",value:function(i){return void 0==i?this.virtual_height:this.height?i/this.height*this.virtual_height:i}}]),i}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,o,t){return o&&e(n.prototype,o),t&&e(n,t),n}}(),SwipeUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getParameterByName",value:function(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=o.exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}},{key:"initSwipe",value:function(e,n,o){$(document.body).css({margin:0,padding:0,"background-color":"#fff","font-size":"26px"}),$("div").css({margin:0,padding:0,"background-color":"#fff","font-size":"26px"});var t=0;location.hash&&(t=Number(location.hash.substr(1)));var i=new SwipeBook(e,t,n,o);this.swipe_book=i,$(n).on("click",function(){i.next()}),$(window).on("hashchange",function(){"#"+i.getStep()!=location.hash&&i.show(Number(location.hash.substr(1)))}),$(window).resize(function(){clearTimeout(window.resizedFinished),window.resizedFinished=setTimeout(function(){i.resize()},250)})}},{key:"getSwipeBook",value:function(){return this.swipe_book}},{key:"merge",value:function(e,n){for(var o={},t=Object.keys(e),i=0;i<t.length;i++)o[t[i]]=e[t[i]];for(t=Object.keys(n),i=0;i<t.length;i++)o[t[i]]=n[t[i]];return o}}]),e}();